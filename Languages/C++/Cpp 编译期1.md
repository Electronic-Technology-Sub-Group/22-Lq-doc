# g++

g++ 是 GCC 中 C++ 的编译器，该集合包括C，C++，Java，Go 等大多数常用语言的编译。 

```ad-note
GCC：GNU Compiler Collection，GNU 编译器集合

gcc：GNU C Compiler，GCC 中 C 语言编译器
```

该编译器中与编译过程相关的参数包括：

- `-E`：仅预处理源文件，生成 `.i` 文件。该文件为文本文件
- `-S`：仅编译源文件，但不进行汇编操作
- `-c`：编译、汇编源文件
- `-g`：开启 GDB 调试器

与编译相关的其他参数包括：

- `-o 文件`：指定输出文件名
- `-l 文件或目录`：附加的库文件或头文件目录，用于手动链接调用库文件、头文件
- `-std=语言标准`：语言标准包括 c++98，c++11 等，指定代码使用的语言标准版本

# 编译与运行

![[Pasted image 20230714213946.png]]

C++ 代码执行需要经过三个（四个）过程（编译和汇编有时笼统称为编译）。以下截图中的参数为 g++ 编译器的参数。

![[Pasted image 20230714181106.png]]

C++ 编译的基本单位是源码文件（通常为 `cpp` 或 `hpp` 文件）而不是头文件或整个项目，在链接之前各个源文件是彼此独立的。

## 预处理

执行编译前的一些准备工作，主要是执行预处理指令（详见 [[Cpp 编译期2]]）。在此过程中，如果存在循环引用，预处理指令的语法问题等会产生对应的异常。

该过程后的结果仍为文本文件，可使用文本编辑器打开，内代码仍是 C++ 代码，只是将某些内容进行了替换、选择和展开。通常，执行该步后文件会增大很多。

## 编译

将预处理后的源代码转换为汇编代码，在该步骤会生成与代码等效的汇编代码，同时若代码中存在语法错误也会报出相应的异常。

该过程后的结果仍为文本文件，打开后的代码为汇编代码。

## 汇编

汇编操作是将汇编代码转化为机器码。该步骤生成的结果称为**目标文件**，该文件为二进制文件。该步 GCC 的 g++ 通过 `as` 程序完成。

## 链接

目标文件是一种中间文件（临时文件），其中只包括我们编写的代码、头文件引入的代码，但缺失了以下内容：
- 程序可能包含多个源文件，各个源文件之间并没有进行链接
- 与依赖的库（标准库、动态链接库、操作系统相关组件等）也没有链接

该步骤实际是将所有目标文件之间及与依赖的库文件打包成一个可执行文件，完成该步骤需要单独的链接器 `ld` 完成。
- 合并段、调整段偏移
- 汇总所有符号
- 完成符号的重定位

# 参考

[详解C/C++代码的预处理、编译、汇编、链接全过程 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/618037867)

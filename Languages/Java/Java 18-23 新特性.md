# Java 18

- 将 UTF-8 作为默认字符集（之前取决于系统）
- 使用 `jwebserver` 可以启动一个简易静态 web 服务器，不支持 CGI 和 Servlet
- Javadoc 中，可使用 `{@snippet 代码块}` 代替 `<pre>{@code 代码块}</pre>` 用于插入代码
- 重新实现了 `Method`，`Constructor`，提高反射性能
# Java 20
## switch 模式匹配
#实验性功能  #Amber

Switch 表达式可判断对象类型了

```java
static String formatterPatternSwitch(Object o) {
    return switch (o) {
        case null      -> "null"
        case Integer i -> String.format("int %d", i);
        case Long l    -> String.format("long %d", l);
        case Double d  -> String.format("double %f", d);
        case String s  -> String.format("String %s", s);
        case default   -> o.toString();
    };
}
```

另外，还支持进一步的复杂检查，使用 `when`

```java
Effect effect;
Guitar guitar;

switch(effect) {
    case Tuner tu when !guitar.isInTune() -> ... ;
    case Tuner tu                         -> ... ; 
}
```

- 当一个模式匹配失败时，抛出 `MatchException`
- `switch` 表达式和语句中支持推断 `record` 模式类型参数，因此可以使用 `var`
## record 模式
#实验性功能  #Amber 

进行模式匹配时，允许对 `record` 类进行解构甚至嵌套解构，解构时可以使用 `var` 推导

```java
record Tuner(int pitchInHz, Note note) implements Effect {}
record Note(String note) {}
class TunerApplier {
    static String apply(Effect effect, Guitar guitar) {
        return switch(effect) {
            case Tuner(int pitch, Note(String note)) -> 
                String.format("Tuner active with pitch %d on note %s", pitch, note);
            // var 版本
            case Tuner(var pitch, Note(var note)) -> 
                String.format("Tuner active with pitch %d on note %s", pitch, note);
        };
    }
}
```

该模式同样适用于 `for-in` 循环

```java
record Delay(int timeInMs) implements Effect {}

class DelayPrinter {
    static void printDelays(List<Delay> delays) {
        for (Delay(var timeInMs) : delays) {
            // do something
            System.out.println("Delay found with timeInMs=" + timeInMs);
        }
    }
}
```
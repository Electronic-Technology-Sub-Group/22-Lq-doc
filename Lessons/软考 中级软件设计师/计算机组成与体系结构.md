# 数据表示

## 进制转换

十进制、二进制（B）、十六进制（H）

- 数码
- 基数
- 位权：第 k 位的位权为 $(基数)^k$
	- 整数部分（小数点左侧）表示当前位置与小数点之间的间隔的数码个数
	- 小数部分（小数点右侧）表示当前位置与小数点之间的间隔的数码个数+1 取负

R 进制转换为十进制：按权展开法 $v = \sum_{i=s}^t{k_i R^i}$
- $v$：转换后的十进制数
- $s$，t：位权
- $k_i$：第 i 位的数码
- $R$：基数

十进制转换为 R 进制：短除法（除基取余法），余数从下往上记录

二进制与八/十六进制转换
- 八/十六进制转二进制：取每一位数码用二进制表示，补齐 3（八进制）/ 4（十六进制） 位（前部补0）
- 二进制转八/十六进制：从后向前每3（八进制）/ 4（十六进制）位用对应八/十六进制的数码表示
## 码制表示

- 符号位：每个数字二进制表示中，最高位第 1 个数字表示是否为负数，1 表示负
- 原码：最高位为符号位，其余各位表示数值的绝对值
	- 由于符号位的存在不能直接运算
	- 由于**存在 `+0`、`-0`**，数码个数为 $2^k-1$（k 为二进制位数）
- 反码：整数不变，负数反码符号位不变，其他位按位取反
- 补码：正数不变，负数为反码+1，可以直接进行加法运算
	- 人为规定：将原本 -0 的补码给最小的负数，如 8 位的数 定义 -128 的补码为 `1000 0000`，因此**数码个数为 $2^k$，最小值为 $-2^{k-1}$**
- 移码：只用于浮点阶码。补码符号位按位取反

|     | 1         | -1        | 1-1（括号十进制表示）   |
| --- | --------- | --------- | -------------- |
| 原码  | 0000 0001 | 1000 0001 | 1000 0010 (-2) |
| 反码  | 0000 0001 | 1111 1110 | 1111 1111 (-0) |
| 补码  | 0000 0001 | 1111 1111 | 0000 0000 (0)  |
| 移码  | 1000 0001 | 0111 1111 | 1000 0000      |
## 浮点表示

浮点数 $N=尾数\times 基数^{指数}$，需要将小数转换为（通常保留一位小数的）科学计数法
- 尾数：前面小数部分，使用定点小数形式存储，通常使用补码，IEEE 754 标准中也可以使用原码
- 基数：2，不需要存储
- 指数：又称阶码，以定点整数的移码形式存储
- 数符、阶符：尾数和指数的符号位，数符决定正负号，阶符决定浮点数绝对值是否大于 1

尾数决定了有效精度，阶码决定存储范围

两个浮点数运算过程如下
1. **对阶**：将阶码小的浮点数的阶码对齐到大的浮点数（**小数向大数看起**），相应的前面尾数会缩小相应倍数（**通过算术右移实现**）
2. 尾数计算
3. 结果格式化：将运算后的结果的尾数调整到 $[0.5, 1]$ 的范围
## 逻辑运算

![[Pasted image 20240229141143.png]]
![[Pasted image 20240229141416.png]]

短路原则：不是所有逻辑运算符都会被执行
# 校验码

在原有信息中增加部分冗余信息用于校验信息是否在传输中发生错误
- 码距：编码由码字构成，任意两个码字之间最小变化的二进制位数称为校验码的码距
## 奇偶校验码

由若干有效位信息和一个二进制位（校验位，一般放在头部）组成校验码，使整个校验码中 1 的个数总为奇数或偶数
- 只能检查奇数个数字位的错误（我们认为传输时错误大多数时候只有一位）
- 不能纠错
## CRC 循环冗余校验码

在 k 位信息码之后拼接 r 位校验码（r 由生成多项式决定，通常拼接在尾部），将收到的 CRC 码用生成多项式相除（**模二除法**），余数为 0 则数据无错误
- 只能检错，不能纠错，可以对任意位数检错
## 海明校验码

在有效信息位中插入几个校验位形成海明码，使码距比较均匀的拉大，并将每个二进制位分配到几个奇偶校验组中，即可检错，又可纠错

校验位求取公式：$2^r\leq m + r + 1$，每个校验位放在第 $2^i$，$i=0, 1, 2, ...$ 个位置上
- r：海明校验位位数求取
- m：信息位个数
设数据位 $D_i$ 在整个校验码中位于第 k 位，选取第 ($p_0$, $p_1$, ..., $p_t$) 个校验位校验，其中 $\sum_{i=0}^t p_i=k$ 且 $\log_2 p\in N^*$，将 k 使用二进制表示出来找每个 1 对应 的数字。
# CPU 组成

计算机结构：
- 外设：输入设备，输出设备，辅助存储设备（辅存/外存，包括硬盘）
- 主机：CPU（运算器+控制器），主存储器（主存/内存）

CPU
- 运算器
	- 算术逻辑单元 ALU：算术运算和逻辑运算
	- 累加寄存器 AC：通用寄存器，为 ALU 提供工作区，暂存数据和结果
	- 数据缓冲寄存器 DR：写内存时暂存指令或数据
	- 状态条件寄存器 PSW *可以分类到控制器 存在争议*：存储运算状态、控制状态
- 控制器
	- 程序计数器 PC：记录**下一条**指令**地址**
	- 指令寄存器 IR：存储即将执行的**指令**
	- 指令译码器 ID：对指令的操作码进行分析解释
	- 时序部件：提供时序信号
# 寻址方式

指令：机器语言的一条语句，一组有意义的二进制代码
- 操作码字段
- 地址字段

寻址方式
- 立即寻址：将操作数直接放到指令中，速度快，灵活性差
- 直接寻址：将操作数的直接地址作为操作数
- 间接寻址：将操作数的地址放在某个存储单元，并将该单元作为操作数（需要两次寻址）
- 寄存器寻址：操作数存放在某个寄存器中
	- 隐含寻址：操作数放在默认寄存器（AC）中
- 寄存器间接寻址：操作数地址放在某个寄存器中
# CISC、RISC

两种指令集

| 类型         | 指令                                                     | 寻址方式      | 实现方式                     | 其他          |
| ---------- | ------------------------------------------------------ | --------- | ------------------------ | ----------- |
| 复杂指令集 CISC | 数量多，使用频率差别大，可变长格式                                      | 较多        | 微程序控制（微码）                | 研制周期长       |
| 精简指令集 RISC | 数量少，使用频率接近，定长格式，大部分是单周期指令，除 LOAD/STORE 指令操作内存外操作的都是寄存器 | 较少，以寄存器为主 | 增加通用寄存器，以硬布线逻辑控制为主，适合流水线 | 优化编译，适合高级语言 |
# 流水线技术

在程序执行时多条指令重叠进行操作的一种准并行处理实现技术。

![[Pasted image 20240229151143.png]]
## 相关计算

![[Pasted image 20240229151649.png]]

流水线建立时间：流水线中第一条指令执行时间
流水线弹出时间：第一条指令之后，每个流水线周期完成一条指令
流水线周期：除第一条指令外，每完成一条指令所需时间 -- 取任务执行中最长的一段
整个流水线执行时间：$(t_1+t_2+...+t_k)+(n-1)t$

![[Pasted image 20240229152259.png]]

实践公式：$kt+(n-1)t$，实践公式比理论公式有所扩大，将流水线建立时的每一段都扩大到流水线周期。当理论公式无答案时使用实践公式。

流水线吞吐率 TP：单位时间流水线完成的任务或输出的结果数
流水线最大吞吐率：使用实践公式计算流水线执行时间的吞吐率，其中 k 看做常数·

$$
TP=\frac{指令条数}{流水线执行时间}
$$
$$
TP_{max}=\lim_{n\rightarrow\infty}\frac{n}{(k+n-1)t}=\frac1t
$$
# 存储系统
## 层次化存储体系结构

![[Pasted image 20240229173319.png]]

层次化存储结构的支撑：局部性原理
- 时间局部性：刚被访问的内容，立即又被访问              -- 循环体
- 空间局部性：刚被访问的内容，临近空间很快被访问   -- 顺序结构

虚拟存储器：主存+外存，主存空间不足时将辅存作为其空间的一部分使用
三级存储体系：外存，主存，Cache

分类
- 按位置：内存，外存
- 按存取方式
	- 按内容存取：相联存储器，如 Cache（按内容本身决定存储位置）
	- 按地址存取：
		- 随机存取存储器，如内存
		- 顺序存取存储器，如磁带
		- 直接存取存储器，如磁盘（移臂调度 -- 随机，旋转延迟 -- 顺序）
- 按工作方式：
	- 随机存取存储器 RAM，如内存 DRAM。掉电丢失
	- 只读存储器 ROM，如 BIOS，掉电保留
	- 其他类型
![[Pasted image 20240229174241.png]]
## Cache

在计算机存储系统体系中访问速度仅次于寄存器
使用 Cache 改善系统性能依据程序局部性原理

命中：访问数据是，数据刚好在 Cache 中。Cache 的访问命中率由**淘汰算法**决定（不是算法的时间复杂度），通常在 90%
失效：未命中的情况

“Cache+主存”系统平均周期 $t_3=ht_1+(1-h)t_2$
- $h$：命中率，$1-h$ 称为失效率
- $t_1$：Cache 周期时间
- $t_2$：主存储器周期时间 

地址映像：将主存与 Cache 的存储空间划分为若干大小相同的页（块）
主存与 Cache 之间的地址映射由硬件直接完成，不需要程序和操作系 统参与

- 直接相联映像：电路简单，冲突率高

![[Pasted image 20240229175954.png]]

- 全相联映像：电路难于设计和实现，适用于小容量 Cache，冲突率低

![[Pasted image 20240229180104.png]]

- 组相联映像：直接相联与全相联的折中

![[Pasted image 20240229180150.png]]
## 主存编址计算

- 比特位：一个二进制位 bit
- 字节：8 bit = 1B
- 存储单元：规定几个字节一组为一个字长，一个字长称为一个存储单元
	- 字长题目没给默认 8，考试中多为 16
- 地址：存储单元编号，从 0 开始二进制编写
	- 存储单元个数 = 最大地址 - 最小地址 + 1
- 编址内容：存储单元内容，一个存储单元存储的比特位数量
	- 按字编址：存储体存储单元是字存储元，最小寻址单位是一个字
	- 按字节编址：存储体存储单元是字节存储元，最小寻址单位是一个字节
- 存储芯片拼接
	- 总容量 = 存储单元个数 * 编址内容
	- 总片数 = 总容量 / 每片芯片容量
# 总线

数据传输方式
- 程序查询（控制）方式：无条件传输和程序查询两种，CPU 轮询 IO 设备，方法简单，硬件开销小，I/O 能力不高
- 程序中断方式：无需 CPU 等待，IO 设备传输结束后通知 CPU，数据传输与 CPU 是并行过程
	- 鼠标键盘等
- DMA 方式：直接主存存取，用于主存与外设之间的高速、批量传输，由 DMAC 控制
	- DMAC 向总线裁决逻辑提出总线请求，CPU在执行完当前总线周期释放总线控制权，DMA响应，通过 DMAC 通知 I/O 接口开始 DMA 传输
	- 硬盘等
- 通道方式（硬件）
- IO处理机（硬件）

中断处理过程

![[Pasted image 20240301163516.png]]

- IO 系统准备好后，向 CPU 发出**中断请求信号**
- CPU 接到中断请求后，**保存现场**（栈），将当前程序位置设置为**断点**
- 通过**中断向量表**，转入对应 IO 服务程序，完成数据交换
- **恢复现场**，返回被打断的程序处继续执行

总线特点：分时双工，同一时刻允许一个设备发送，多个设备接收
- 数据总线 DB：CPU 与 RAM 之间传递待处理或待存储的数据
- 地址总线 AB：指定在 RAM 中存储的数据地址
- 控制总线 CB：将微处理控制单元（CU）的信号传递到周边设备

*并行总线适合近距离传输，串行总线适合长距离传输*
# 可靠性

指标：
- 平均无故障时间：系统正常运行时间，$MTTF = \frac1\lambda$，$\lambda$ 为失效率
- 平均故障修复时间：修复故障时间，$MTTR = \frac1\mu$，$\mu$ 为修复率
- 平均故障间隔时间：两次故障的间隔时间，$MTBF=MTTR+MTTF$
- 系统可用性（可靠性）：$R=\frac{MTTF}{MTTR+MTTF}\times 100\%$

实际应用时，MTTR 通常很小
- $MTBF\approx MTTF$
- 可用性（可靠性） $R=\frac{MTTF}{1+MTTF}$

串联系统中，有 $R_1$，$R_2$，...，$R_n$ 步串联（冗余系统），则
- $R=R_1\times R_2\times ...\times R_n$
- $\lambda=\lambda_1+\lambda_2+...+\lambda_n$
并联系统中，有 $R_1$，$R_2$，...，$R_n$ 步并联，则
- $R=1-(1-R_1)\times (1-R_2)\times ...\times (1-R_n)$
- $\mu=\dfrac1{\frac1\lambda \sum_{j=1}^{n}{\frac1j}}$
# 性能指标

字长：单位 bit，一次可以读的数据长度
数据通路宽度：单位 bit，一次（一个数据脉冲）可读取数据量
主频：一秒可读取的数据量
CPU 时钟周期：一次读取（一个数据脉冲）的时间，为主频的倒数
CPI：每条指令占用的时钟周期
- IPC：每个时钟周期完成的指令条数
MIPS：百万条指令每秒
- MFLOPS：百万条浮点操作次数每秒
吞吐量：给定时间完成的任务量
- 吞吐率：单位时间的吞吐量
响应时间 RT，提交请求到完成请求的时间
- 完成时间 TAT：事务、指令执行完成的时间
# HTTP 协议

- 通信协议：通信双方完成通信所必须遵守的规则和约定，即约定的发送和接收的消息的格式
- HTTP 协议：超文本传输协议，`HyperText Transfer Protocol`，用于传输超文本内容的协议
	- 模型：请求 - 响应模型

![[Pasted image 20230420163003.png]]

# HTTP 请求

- HTTP 请求：由客户端发起的请求
- HTTP 请求消息：又称 HTTP 请求报文，客户端向服务端发送的消息

HTTP 请求由请求行，请求头，空行和请求体四部分组成，空行分隔请求头和请求体

![[Pasted image 20230420163526.png]]

## 请求行

`请求方式 URL 协议版本`

- 请求方法：客户端要对服务器资源执行的操作，最常见的是 GET 和 POST

| 请求方法   | 说明                                                          |
| ---------- | ------------------------------------------------------------- |
| **GET**    | 获取服务器资源                                                |
| **POST**   | 向服务器提交资源，如表单和文件等                              |
| **PUT**    | 向服务器提交资源，用于替换服务器旧资源                        |
| **DELETE** | 删除服务器资源                                                |
| HEAD       | 请求一个与 GET 请求相同的响应，但没有响应体                   |
| OPTIONS    | 获取服务器支持的请求方法，用于查看服务器性能，Ajax 跨域预检等 |
| CONNECT    | 建立由目标资源标志到服务器的隧道                              |
| TRACE      | 沿到目标资源的路径执行一个消息回环测试，用于测试和诊断        |
| PATCH      | 对 PUT 的补充，对已知资源的局部更新                           |

## 请求头

`请求字段:值 ...`

常见头部字段：
| 字段            | 说明                        |
| --------------- | --------------------------- |
| Host            | 服务器域名                  |
| Connection      | 连接方式，close / keepalive |
| Content-Length  | 请求体大小                  |
| Accept          | 可接收响应类型              |
| User-Agent      | 客户端系统及浏览器类型      | 
| Content-Type    | 客户端发送的数据类型        |
| Accept-Encoding | 客户端可识别的压缩编码格式  |
| Accept-Language | 客户端期望的自然语言顺序    |

## 请求体

由 POST 请求提交给服务器的数据，GET 不存在请求体

# HTTP 响应

响应消息：又称响应报文，服务器相应给客户端的消息，由状态行，响应头部，空行，响应体组成，空行分隔响应头和响应体

![[Pasted image 20230420164539.png]]

## 状态行

`HTTP协议版本 状态码 状态码描述文本`

状态码：HTTP Status Code，用于标识响应状态，由三位十进制组成

- 1XX：信息，服务器收到请求，需要请求者继续操作
- 2XX：成功，操作被成功接收和处理

| 状态码 | 名称    | 描述                                       |
| ------ | ------- | ------------------------------------------ |
| 200    | OK      | 请求成功，多用于 GET 和 POST               |
| 201    | Created | 已创建，成功创建新资源，多用于 POST 和 PUT | 

- 3XX：重定向，操作需要进行另一个操作以继续

| 状态码 | 名称              | 描述                                                                   |
| ------ | ----------------- | ---------------------------------------------------------------------- |
| 301    | Moved Permanently | 永久移动：请求资源已经永久移动到新的 URI，后续将跳转到新 URI           |
| 302    | Found             | 临时移动：请求资源暂时移动到新的 URI，后续将跳转到新 URI               |
| 304    | Not Modified      | 未修改：请求的资源未被修改，不返回任何资源，后续由客户端使用缓存的资源 | 

- 4XX：客户端错误，请求包含语法错误或无法满足请求

| 状态码 | 名称            | 描述                                         |
| ------ | --------------- | -------------------------------------------- |
| 400    | Bad Request     | 请求语义有误或参数错误                       |
| 401    | Unauthorized    | 当前请求需要用户验证                         |
| 403    | Forbidden       | 服务器已经理解请求，但拒绝执行               |
| 404    | Not Found       | 服务器无法根据请求找到对应资源               |
| 408    | Request Timeout | 请求超时，服务器等待客户端发送的请求时间过长 | 

- 5XX：服务器错误，服务器在处理请求的过程中发生错误

| 状态码 | 名称                  | 描述                                                    |
| ------ | --------------------- | ------------------------------------------------------- |
| 500    | Internal Server Error | 服务器内部错误                                          |
| 501    | Not Implemented       | 服务器不支持该请求，仅 GET 和 HEAD 是服务器必须要支持的 |
| 503    | Service Unavailable   | 超载或系统维护造成的服务器暂时无法处理请求              | 

## 响应头部

描述服务器基本信息，多个键值对组成

`键:值`

常见响应头部字段：
| 字段           | 说明           |
| -------------- | -------------- |
| X-...          | 自定义响应字段 |
| Content-Type   | 响应体类型   |
| Content-Length | 响应体长度   |
| Date           | 响应时间       |
| Connection     | 响应类型       | 

## 响应体

服务器响应给客户端的数据

# HTTP 无状态性

HTTP 无状态性：客户端每次 HTTP 请求都是相对独立的，连续多个请求之间没有直接关系，服务器不会主动保留每次 HTTP 请求的状态

为保证请求的连续性，产生了 Cookie 等技术

# Authentication

又称身份认证或鉴权，通过一定手段，完成对用户身份确认
- 服务端渲染模式推荐使用 Session 认证机制
- 前后端分离模式且需要跨域访问时推荐使用 [[JS WebAPI#JWT|JWT]] 认证机制

## Session

### Cookie

> `Cookie` 是存储在浏览器中的不超过 4K 的字符串，由一个名称，一个值和多个用于控制 `Cookie` 的有效期、安全性、适用范围等可选属性组成

不同域名的 Cookie 各自独立，当发出请求时，浏览器会自动将用于该域名所有未过期的 Cookie 一同发送给服务器

客户端发起第一次请求时，浏览器将用于身份认证的 Cookie 通过响应头发送给浏览器，之后每次访问时客户端将 Cookie 通过请求头发送给服务器，使浏览器可以了解客户端身份

特点：
- 自动发送：每次请求都由浏览器自动发送
- 域名独立：不同域名之间 Cookie 彼此独立
- 过期时限：Cookie 都有过期时限，过期即作废
- 4K限制：一条 Cookie 最大为 4K 大小

**不安全性：Cookie 存储于客户端，且浏览器提供读写 Cookie 的 API，因此 Cookie 易被伪造，不能存储用户隐私等敏感信息**

Session 基于 Cookie 实现：
1. C：客户端向服务器发送登录申请，并提交对应数据
2. S：服务器验证账户后生成一段数据，该数据不包含用户信息，但与用户信息在服务器中一一对应
3. S：服务器将该段数据作为 Cookie 信息发送给客户端，客户端浏览器保存该信息
4. C：之后客户端每次请求，都将该 Cookie 信息一并发送给服务器
5. S：服务器根据 Cookie 信息查询用户信息，并根据用户信息发送不同响应内容

## JWT

JWT 主要用于解决 Session 机制固有限制的问题：使用 Cookie，默认不支持跨域访问

> JWT: JSON Web Token

鉴权流程：与 Session 的区别是，生成 Token 字符串并手动保存和发送
1. C：客户端提交登录信息，发送登录请求
2. S：服务器校验成功，根据用户信息生成 `Token` 字符串发送给客户端
3. C：客户端将 `Token` 字符串保存到 `LocalStorage` 或 `SessionStorage`，并在之后的请求中将其添加到请求头的 `Authorization` 字段中，该字段的值为 `Bearer token值`
4. S：服务器根据 `Token` 字符串发送不同信息

### Token

JWT 的 Token 由三部分组成，由 `.` 分隔
- `Header`：头部，保证 Token 安全性
- `Payload`：有效载荷，加密后的用户信息字符串
- `Signature`：签名，保证 Token 安全性

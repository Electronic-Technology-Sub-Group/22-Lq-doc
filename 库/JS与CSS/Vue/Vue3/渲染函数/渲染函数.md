# 渲染函数

虚拟渲染：使用 JavaScript 创建 DOM 元素的方法

应尽可能使用模板创建 HTML，虚拟渲染仅在必要时候使用

在组件配置的 `render` 方法中使用 `Vue.h(tag, props, children)` 创建虚拟 DOM 元素（`VNode`），实现虚拟渲染

`Vue.h` 是 `Vue.createVNode` 的别名

* `tag`：代表虚拟 DOM 的元素类型

  * HTML 标签：DOM 标签类型字符串，如 `<a>` 对应的是 `'a'` 等
  * 组件：组件对象
  * 函数
  * 注释：`null`
* `props`：可选，一个对象，包含该元素的属性，事件，`props` 等
* `children`：可选，该元素的子元素，是一个给定类型的对象或数组，可包含类型为：

  * `Vue.h` 创建的 `VNode`
  * 字符串，可转换为文本 `VNode`
  * 有 `slot` 的对象

`Vue,h` 函数中可以通过 `this` 访问传递进来的函数，通过 `$slots` 创建 `<slot>`，其中 `$slot.default()` 表示没有 `name` 的 `slot`

![[image-20240525182439-xw98in7.png]]

```html
<div id="app">
    <anchored-heading :level="1" title="锚点 1">Hello World111!</anchored-heading>
    <anchored-heading :level="2" title="锚点 2">Hello World222!</anchored-heading>
    <anchored-heading :level="3" title="锚点 3">Hello World333!</anchored-heading>
    <anchored-heading :level="4" title="锚点 4">Hello World444!</anchored-heading>
    <anchored-heading :level="5" title="锚点 5">Hello World555!</anchored-heading>
</div>
```

使用模板创建 `anchored-heading` 组件要使用大量 `v-if` 分支，冗长且不利于扩展

```html
<div id="myanchored">
    <h1 v-if     ="level === 1"><a :href="'#' + title"><slot></slot></a></h1>
    <h2 v-else-if="level === 2"><a :href="'#' + title"><slot></slot></a></h2>
    <h3 v-else-if="level === 3"><a :href="'#' + title"><slot></slot></a></h3>
    <h4 v-else-if="level === 4"><a :href="'#' + title"><slot></slot></a></h4>
    <h5 v-else-if="level === 5"><a :href="'#' + title"><slot></slot></a></h5>
</div>
```

```js
const MyAnchored = {
    template: '#myanchored',
    props: {
        level: Number,
        title: String
    }
}
```

可以自定义 `render` 方法使用渲染函数渲染

```js
const MyAnchored = {
    render() {
        // <h{level}><a href="#{title}"><slot></slot></a></h{level}>
        return Vue.h(`h${this.level}`, [
            Vue.h('a', {
                href: `#${this.title}`
            }, this.$slots.default())
        ])
    },
    props: {
        level: Number,
        title: String
    }
}
```

对应的 `app` 程序配置：

```js
Vue.createApp({})
    .component('anchored-heading', MyAnchored)
    .mount('#app')
```

渲染函数创建的元素只能用一次，无法复用，但可以通过创建一个工厂函数实现创建多个相同的元素

```js
Vue.createApp({}).component('my-com', {
    render() {
        const myParagraph = Vue.h('p', 'hi')
        // 错误
        return Vue.h('div', 
                     [myParagraph, myParagraph])
    }
})
```

```js
function createParagraph() {
    return Vue.h('p', 'hi')
}
Vue.createApp({})
    .component('my-com', {
        render() { // ok
            return Vue.h('div', 
                         [createParagraph(), createParagraph()])
        }
    })
    .mount('#app')
```

‍

# 自定义指令

指令是 Vue 定义的 HTML 元素属性，使用 app 配置中的 `directives` 块或 `app.directive` 注册自定义指令，作为局部指令或全局指令。

```js
const app = Vue.createApp({
    directives： {
        <attr>: { option }
    }
})
app.directive('<attr>', { option })
```

* `<attr>`：指令名，即属性名，**不包含** **`v-`**  **前缀**
* `{ option }`：指令选项，包含几个生命周期事件的钩子函数，完整的参数列表包括 `el`，`binding`，`vnode`，`prevNode`

  * `el`：指令所在元素，可用于直接操作 DOM
  * `binding`：指令相关参数，是一个对象 `{ value, oldValue, arg, modifiers }`

    * `value`：指令绑定值，如 `v-my-directive="1+1"` 的绑定值为 2
    * `oldValue`：上一个绑定值，*仅* *`updated`* *钩子函数可用*
    * `arg`：指令参数，如 `v-my-directive:foo` 的参数为 `"foo"`
    * `modifiers`：指令修饰符，如 `v-my-directive.foo.bar` 的 `modifiers` 为 `{ foo=true, bar=true }`
  * `vnode`：Vue 编译生成的虚拟节点
  * `prevNode`：上一个虚拟节点，*仅* *`updated`* *钩子函数有效*

```html
<span v-demo:msg.a.b="message"></span>
```

```js
app.directive('demo', {
    beforeMount(el, binding, vnode) {
        const keys = Object.keys(vnode)
        el.innerHTML = `value: ${binding.value}<br>
                        arguments: ${binding.arg}<br>
                        modifiers: ${JSON.stringify(binding.modifiers)}<br>
                        vnodes: ${keys.join(', ')}`
    }
```

* `<attr>`：`demo`
* `el`：实际生成的 `span` 标签
* `binding.value`：`Hello`
* `binding.arg`：`msg`
* `binding.modifiers`：`{"a":true,"b":true}`
* `vnodes`：`{ ... }`

![[image-20240525021904-hfonywo.png]]

‍

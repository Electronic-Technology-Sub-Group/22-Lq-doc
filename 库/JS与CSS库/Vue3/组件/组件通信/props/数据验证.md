# 数据验证

当组件需要接收第三方传入的数据时，最好进行数据验证，通过对象类型的 `props` 块实现：

* 仅判断类型：属性值为类型的构造或其数组

  ```js
  props: {
      // num 参数只能是数字
      num: Number,
      // strnum 参数可以是数字或字符串
      strnum: [Number, String]
  }
  ```
* 必要性检查：属性值为一个对象，且包含 `required: true` 属性

  ```js
  props: {
      // 必须包含 isrequired 参数，且该参数类型为字符串
      isrequired: {type: String, required: true}
  }
  ```
* 默认值：属性值为一个对象，且包含 `default` 属性。`default` 属性值可以是默认值，也可以是一个产生值的函数

  ```js
  props: {
      // numdefault 参数必须是数字，且默认值为 100
      numdefault: {type: Number, default: 100},
      // objectdefault 参数为对象，且默认值通过给定函数创建 { message: 'hello' }
      objectdefault: {
          type: Object, default: () => { return {message: 'hello'} }
      }
  }
  ```
* 自定义校验：属性值为一个对象，且包含 `validator` 属性。`validator` 属性值为一个用于校验的函数，返回 `bool`

  ```js
  props: {
      // myfun 校验函数为给定函数
      myfun: {
          validator: value => ['success', 'warning', 'danger'].indexOf(value) !== -1
      }
  }
  ```

```js
Vue.createApp({})
  .component('validate-post', {
    props: {
      num: Number,
      strnum: [Number, String],
      isrequired: {type: String, required: true},
      numdefault: {type: Number, default: 100},
      objectdefault: {
        type: Object, default: () => { return {message: 'hello'} }
      },
      myfun: {
        validator: value => 
          ['success', 'warning', 'danger'].indexOf(value) !== -1
      }
    },
    template: '#validate'
  })
  .mount('#validate-post-demo')
```

```html
<template id="validate">
    <div>
        <h4>{{num}}</h4>
        <h4>{{strnum}}</h4>
        <h4>{{isrequired}}</h4>
        <h4>{{numdefault}}</h4>
        <h4>{{objectdefault}}</h4>
        <h4>{{myfun}}</h4>
    </div>
</template>

<div id="validate-post-demo">
    <validate-post :num="200"
                   :strnum="'sdf'"
                   :isrequired="'abc'"
                   :numdefault="300"
                   :objectdefault="{a: 'a'}"
                   :myfun="'aaa'"></validate-post>
</div>
```

虽然所有条目都正常显示出来了，但控制台可以看见，Vue 产生了一个警告，提示 `myfun` 校验失败

`myfun` 校验函数表示给定值必须是 `success`、`warning`、`danger` 三者之一

![[image-20240524005044-2r55tyi.png]]

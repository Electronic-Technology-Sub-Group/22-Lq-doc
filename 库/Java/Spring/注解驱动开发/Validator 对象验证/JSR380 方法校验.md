# JSR380 方法校验

((20240403020152-w13tffx "JSR380")) 支持对方法的参数和返回值进行验证。该功能通过 `MethodValidationPostProcessor` 处理器完成。

```xml
<bean class="org.springframework.validation.beanvalidation.MethodValidationPostProcessor" />
```

在注册好 `MethodValidationPostProcessor` 后，将注解标注到函数参数上表示校验参数，注解到函数上表示校验其返回值。

同时，还要在需要校验的方法所在类上增加 `@Validated` 注解。

```java
@Validated
public interface CustomerRequestService {

    @Future
    Calendar submitRequest(@NotBlank String type,
                           @Size(min = 20, max = 100) String description,
                           @Past Calendar accountSinceDate);
}
```

当我们调用相应函数时，若参数或返回值不匹配则产生 `ConstraintViolationException` 异常

```java
try {
    // jakarta.validation.ConstraintViolationException: submitRequest.description: 个数必须在20和100之间
    customerRequestService.submitRequest("request type", "description < 20", Calendar.getInstance());
} catch (ConstraintViolationException e) {
    System.out.println(e);
}
try {
    Calendar futureDate = Calendar.getInstance();
    futureDate.add(Calendar.YEAR, 1);
    // jakarta.validation.ConstraintViolationException: submitRequest.accountSinceDate: 需要是一个过去的时间
    customerRequestService.submitRequest("request type", "request: description > 20", futureDate);
} catch (ConstraintViolationException e) {
    System.out.println(e);
}
try {
    Calendar pastDate = Calendar.getInstance();
    pastDate.add(Calendar.YEAR, -1);
    // jakarta.validation.ConstraintViolationException: submitRequest.<return value>: 需要是一个将来的时间
    customerRequestService.submitRequest("request type", "request: description > 20", pastDate);
} catch (ConstraintViolationException e) {
    System.out.println(e);
}
```

‍

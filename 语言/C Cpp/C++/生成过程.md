---
语言: cpp
语法类型: 编译器
---
‍ ![[Pasted image 20230714213946-20240309022315-wfi79oj.png]]

C++ 代码从编译到执行需要经过四个过程。C/C++ 常见编译器有 GCC，MSVC 和 CLang

C++ 编译的基本单位是源码文件而不是头文件或整个项目，在链接之前各个源文件是彼此独立的。

> [!note] 源码文件
> 通常为 cpp 或 hpp 文件，包含程序代码

>[!note] 头文件
>通常为后缀名为 .h 或 .hxx 的文件，用于声明函数、类型等

# 预处理

执行编译前的一些准备工作，主要是执行预处理指令。在此过程中，如果存在循环引用，预处理指令的语法问题等会产生对应的异常。

> [!error] 循环引用
> 若头文件 A 引入了头文件 B，B 又引入了 A，则会产生循环引用问题。可以尽量使用前向声明对其进行解绑，在源码文件中再引入相应的头文件

该过程后的结果仍为文本文件，内代码仍是 C++ 代码，只是将某些内容进行了替换、选择和展开，执行该步后文件会增大很多。
# 编译

将预处理后的源代码转换为汇编代码，在该步骤会生成与代码等效的汇编代码，同时若代码中存在语法错误也会报出相应的异常。

该过程后的结果仍为文本文件，打开后的代码为汇编代码。

# 汇编

汇编操作是将汇编代码转化为机器码。该步骤生成的结果称为**目标文件**，为**二进制**文件。该步 GCC 的 g++ 通过 `as` 程序完成。

# 链接

目标文件是一种中间文件，包括我们编写的代码、头文件引入的代码，但还缺少：
* 程序可能包含多个源文件，各个源文件之间并没有进行链接
* 与依赖的库（标准库、动态链接库、操作系统相关组件等）也没有链接

该步骤实际是将所有目标文件之间及与依赖的库文件打包成一个可执行文件，完成该步骤需要单独的链接器 `ld` 完成。
* 合并段、调整段偏移
* 汇总所有符号
* 完成符号的重定位

# 参考

https://zhuanlan.zhihu.com/p/618037867
#java9 

Jigsaw 是 Java 9 提供的模块系统，主要为了解决以下问题：
* JAR-Hell 问题：
    * 包无法控制包内内容的可见性
    * 除了以 java 和 javax 开头的包外，包应该是开放扩展的。如果你在具有包级别访问的 JAR 中进行了类型化，则可以在其他 JAR 中访问定义与你的名称相同的包中的类型。 ？？？
    * 运行时无法区别相同包的不同版本，不同依赖的同包同名类仅加载第一个
    * 运行时可能会出现类丢失现象，由于缺少某个 JAR 包导致运行时错误
    * 启动时无法检查是否丢失某个类或者包含了错误版本的 JAR 包
* JDK/JRE 单体结构：JRE 作为一个整体，无法按需仅加载某些模块

于是在包 `package` 之上增加一级模块 `module`，声明依赖及开放接口。

一个模块除了是包的容器外，还包含其他信息：
* 依赖的其他包列表
* 公开 API 列表
* 公开反射访问列表
* 使用和提供的服务列表

除关键内部 API（`sun.misc.Unsafe` 等）外，默认强封装 JDK 内所有元素，将来只能通过 `-add-opens` 打开

# JDK 模块

* 标准模块：以 `java` 为前缀，包含于 Java SE 中，如 `java.base`, `java.sql`, `java.xml`, `java.logging` 等
    * 原始模块： `java.base`，不依赖于其他任何模块，包含核心基础包
* 非标准模块：以 `jdk` 为前缀，作为 JDK 的一部分但不包含于 Java SE 平台规范中，可能会在未经通知的情况下改变，如 `jdk.charsets`, `jdk.compiler`, `jdk.jlink`, `jdk.zipfs` 等
* JavaFX：以 `javafx` 为前缀，但并非 JavaSE 标准的一部分，如 `javafx.base`, `javafx.controls`, `javafx.fxml` 等

> [!warning] JDK 中还存在一系列内部 API，包括 `com.sun.*`, `sun.*`, `jdk.*`，通常依赖于特定的 JDK 实现。在 Java 9 中，这些内部 API 中某些常用类被释放到公共 API 中，另一些被放置在 `jdk.unsupported` 模块中。

![[Pasted image 20240806134426.png]]

# 模块层

模块安排成层。一个模块层是一组解析的模块，具有将每个模块映射到负责加载该模块中所有类型的类加载器的功能。

解析模块的集合称为配置。层次分层排列。层除了空层以外还有至少一个父层，顾名思义，它不含任何模块，主要用作引导层的父层。

引导层由启动时由 JVM 创建，通过针对一组可观察模块解析应用程序的初始模块（根模块）。

可以创建自定义层。模块层允许将同一模块的多个版本加载到不同的层中，并在同一个 JVM 中使用。